# 2025.05.05
# 官网：https://nsloon.app
# 文档：https://nsloon.app/docs/intro

# 各个模块说明「基于 loon 3.3.0 制作」
# 注意：去掉前面的注释符号 "#" 该行生效，（开启关闭参数：true/false）
# 规则逻辑：排在前面的优先级高于后面的，本地规则 > 插件规则 > 订阅规则

# other 设置补充说明
# 自定义 geoip & ipasn 数据库
# https://github.com/Hackl0us/GeoIP2-CN
# https://github.com/Loyalsoldier/geoip
# https://github.com/P3TERX/GeoLite.mmdb
# https://github.com/MetaCubeX/meta-rules-dat

# 图标订阅「更多 -ui 配置 - 图标集」
# aimetu 108*108 图标
# https://raw.githubusercontent.com/aimetu/icons/main/icons.json

# http 本地服务器「浏览器打开」
# boxjs 订阅脚本挂载 substore 本地订阅转换
# http://boxjs.com
# https://sub.store

# boxjs 订阅脚本
# https://raw.githubusercontent.com/Peng-YM/QuanX/master/Tasks/box.js.json
# https://raw.githubusercontent.com/evilbutcher/Quantumult_X/master/evilbutcher.boxjs.json
# https://qxnav.com/rules/QuantumultX/qixin.boxjs.json
# https://raw.githubusercontent.com/xream/scripts/main/boxjs/boxjs.json

# 网络连通性检查使用的 url
# http://www.google.com/generate_204
# http://www.gstatic.com/generate_204
# https://cp.cloudflare.com/generate_204
# http://connectivitycheck.gstatic.com/generate_204
# http://www.msftncsi.com/ncsi.txt
# http://www.msftconnecttest.com/connecttest.txt
# http://detectportal.firefox.com/success.txt
# http://captive.apple.com/hotspot-detect.html

# 💡 通用设置
[General]
# 网络 ip 模式（ ipv4-only：仅有 ipv4, dual：自动 ipv4 & ipv6, ipv4-preferred：优先 ipv4, ipv6-preferred：优先 ipv6 ）
ip-mode = dual

# 是否开启 ipv6 流量转发 ( off：不处理ipv6流量、auto：根据当前网环境自动决定、always：强制接管tun 的ipv6流量 )
ipv6-vif = auto

# 网络接口模式 ( auto：系统分配、cellular：强制蜂窝、performance：最优网络、balance：均衡负载 )
interface-mode = auto

# 自定义 geoip 地理位置数据库
geoip-url = https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/country-lite.mmdb

# 自定义 asn 地理位置数据库
ipasn-url = https://github.com/MetaCubeX/meta-rules-dat/releases/download/latest/GeoLite2-ASN.mmdb

# 绕过路由模式（ 绕过 tun 由系统直接处理 ）
bypass-tun = 10.0.0.0/8, 100.64.0.0/10, 127.0.0.0/8, 169.254.0.0/16, 172.16.0.0/12, 192.0.0.0/24, 192.0.2.0/24, 192.88.99.0/24, 192.168.0.0/16, 198.18.0.0/15, 198.51.100.0/24, 203.0.113.0/24, 224.0.0.0/4, 255.255.255.255/32

# 绕过代理模式（ 强制使用 tun 不会转发到 Loon 代理 ）
skip-proxy = 10.0.0.0/8, 17.0.0.0/8, 100.64.0.0/10, 172.16.0.0/12, 192.168.0.0/16, 127.0.0.1, ::1/128, fe80::/10, *.lan, *.local, localhost

# 策略切换时强制断开该策略的使用连接
disconnect-on-policy-change = true

# 域名拦截时机 DNS、Request 二种方式，DNS：通过 dns-reject-mode 拦截请求的目的，Request：在请求阶段拦截请求
domain-reject-phase = DNS

# 域名拦截时机为 DNS 请示时三种方式：LoopbackIP：返回回环地址，NoAnswer: 返回空的 DNS 响应，NXDomain：返回域名无记录的异常代码
dns-reject-mode = LoopbackIP

# sni 域名嗅探
sni-sniffing = true

# 指定 url 进行直连网络的连通性检测
internet-test-url = http://www.msftncsi.com/ncsi.txt

# 指定 url 进行代理服务器的连通性检测
proxy-test-url = http://www.gstatic.com/generate_204

# 节点测速时的超时 "秒" 数
test-timeout = 3

# 资源解析器连接
resource-parser = https://github.com/sub-store-org/Sub-Store/releases/latest/download/sub-store-parser.loon.min.js

# 配置的域名不会使用 fakeip 进行映射，返回真实的 ip
real-ip = *.msftncsi.com, *.msftconnecttest.com, cable.auth.com, captive.apple.com, *.cmpassport.com, id6.me, open.e.189.cn, mob.com, hmrz.wo.cn, auth.wosms.cn, mdn.open.wo.cn, id.mail.wo.cn, opencloud.wostore.cn, nishub1.10010.com, enrichgw.10010.com, localhost.*.qq.com, localhost.*.weixin.qq.com

# 劫持自定义 dns 服务，返回假的 ip 地址响应（*:0/所有，*:53/所有53端口，8.8.8.8/所有该地址的查询）
hijack-dns = *:53

# 禁用 stun 协议的 udp 数据，阻止 webrtc 泄露真实的 ip 
disable-stun = true

# 当规则匹配的策略不支持 udp 中继时，使用以下策略进行 udp 数据转发
udp-fallback-mode = REJECT

# 是否开启局域网代理访问
allow-wifi-access = false

# 开启局域网 http 代理服务端口
wifi-access-http-port = 8899

# 开启局域网 socket5 代理服务端口
wifi-access-socket5-port = 8898

# 网络自动切换模式，default：默认网络，cellular：蜂窝网络，ssid：wifi 网络 ( 目前支持三种模式：rule/自动分流，direct/全局直连，proxy/全局代理 ）
# ssid-trigger = "default":rule, "cellular":rule, "OpenWrt_2.4G":direct, "OpenWrt_5.8G":proxy

# 默认 dns 服务器，如失败回落默认 dns（默认 53 端口）
dns-server = 223.5.5.5, 119.29.29.29

# 设置 doh 服务器，支持 doq > doh3 > doh 混合使用，并发请求选取最优结果（默认 443 端口）
doh-server = https://doh.pub/dns-query

# 设置 doh3 服务器（ https 或 h3 开头），支持 doq > doh3 > doh 混合使用，并发请求选取最优结果（默认 443 端口）
doh3-server = h3://dns.alidns.com/dns-query

# 设置 doq 服务器，支持 doq > doh3 > doh 混合使用，并发请求选取最优结果（默认 784 端口）
doq-server = quic://dns.alidns.com:853

# 💡 指定 dns 服务器解析域名
# 域名映射对应的 ip 地址
# 域名指定 dns 解析
# 域名映射域名
# 域名指定网络 ip 模式
# ssid 环境下使用特定的 dns 服务器
[Host]
my.router = router.local
*.home.arpa = ip-mode:dual
doh.pub = 120.53.53.53
dns.alidns.com = 223.5.5.5
dns.opendns.com = 208.67.222.222
dns.adguard-dns.com = 94.140.14.14
cloudflare-dns.com = 104.16.249.249
talk.google.com = 108.177.125.188
mtalk.google.com = 108.177.125.188
blog.google = server:94.140.14.14
dl.google.com = server:https://dns.adguard-dns.com/dns-query
dl.l.google.com = server:https://dns.adguard-dns.com/dns-query
update.googleapis.com = server:quic://dns.adguard-dns.com

# ssid
ssid:OpenWrt_2.4G = server:https://dns.alidns.com/dns-query
ssid:OpenWrt_5.2G = server:h3://dns.alidns.com/dns-query
ssid:OpenWrt_5.8G = server:quic://dns.alidns.com:853

# 💡 本地代理服务器
[Proxy]
# wireguard 代理服务器地址：engage.cloudflareclient.com，162.159.192-195.0/24，（udp 端口:2408，备选 500、1701、4500）
🌤️ WARP-TEAM = wireguard, interface-ip = 172.16.0.2, interface-ipv6 = 2606:4700:110:8f21:225d:3e30:7660:78cf, private-key = "QOmt5UE2jp5s2vqYMKmjd714tBC7eteELAFRCEinJG4=", mtu = 1500, dns = 1.1.1.1, dnsv6 = 2606:4700:4700::1111, keepalive = 45, peers = [{public-key="bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=", allowed-ips = "0.0.0.0/0, ::/0", endpoint = engage.cloudflareclient.com:2408, reserved = [80,73,10]}]
🌤️ WARP-PLUS = wireguard, interface-ip = 172.16.0.2, interface-ipv6 = 2606:4700:110:89db:66c6:5265:3a6f:b92, private-key = "wEPBA9NACxZ+lfcTD0yFDrx83RNWseNw2O3yJYWeVmk=", mtu = 1500, dns = 1.1.1.1, dnsv6 = 2606:4700:4700::1111, keepalive = 45, peers = [{public-key="bmXOC+F1FxEMF9dyiK2H5/1SUtzH0JuVo51h2wPfgyo=", allowed-ips = "0.0.0.0/0, ::/0", endpoint = 162.159.195.1:2408, reserved = [173,82,247]}]

# 💡 代理链转发，可添加节点或策略组
[Proxy Chain]
🌤️ WARP+ = HongKong, 🌤️ WARP-TEAM, udp = true

# 💡 远程代理服务器（ 订阅添加后缀 &flag=mixde&types=all、＆flag=[ua]&types=[hysteria2] 根据不同 ua|type（节点类型）获取不同的配置 ）
[Remote Proxy]
Subscribe = https://sub.store/download/collection/node, parser-enabled = true ,udp = true, fast-open = false, vmess-aead = true, skip-cert-verify = default, enabled = false, flexible-sni = true

# 💡 节点筛选
# 筛选订阅节点，筛选后的结果可加入到策略组中，目前支持三种筛选方式
# nodeselect: 手动选择需要组合的节点
# namekeyword: 根据节点名字中是否包含相关关键词进行筛选
# nameregex: 使用正则表达式对节点的名字进行筛选
# 保留所有节点 = .*     
# 保留节点 A 或 B = ^.*(A|B)
# 保留节点有 A 或 B = (A.*B|B.*A)
# 节点不含有 A = ^(?!.*A)
# 节点有 A 但不含有 B = ^(?!.*B).*A
[Remote Filter]
Local = NameRegex, Local, FilterKey = "(?i)"
ALL = NameRegex, FilterKey = "(?i)"
HK = NameRegex, FilterKey = "(?i)(🇭🇰|香港|hk|hong|hongkong)"
TW = NameRegex, FilterKey = "(?i)(🇹🇼|台湾|台北|臺灣|tw|tai|taiwan)"
JP = NameRegex, FilterKey = "(?i)(🇯🇵|日本|川日|东京|大阪|泉日|埼玉|沪日|深日|jp|japan)"
KR = NameRegex, FilterKey = "(?i)(🇰🇷|韩国|韓國|首尔|朝鲜|kr|kor|korea)"
SG = NameRegex, FilterKey = "(?i)(🇸🇬|新加坡|狮城|sg|singapore)"
US = NameRegex, FilterKey = "(?i)(🇺🇸|美国|美國|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|us|america)"
UN = NameRegex, FilterKey = "^((?!🇨🇳|中国|大陆|国内|回国|cn|china|电信|移动|联通|腾讯|阿里|教育|校园|直连|🇭🇰|香港|hk|hong|hongkong|🇹🇼|台湾|台北|臺灣|tw|tai|taiwan|🇯🇵|日本|川日|东京|大阪|泉日|埼玉|沪日|深日|jp|japan|🇰🇷|韩国|韓國|首尔|朝鲜|kr|kor|korea|🇸🇬|新加坡|狮城|sg|singapore|🇺🇸|美国|美國|波特兰|达拉斯|俄勒冈|凤凰城|费利蒙|硅谷|拉斯维加斯|洛杉矶|圣何塞|圣克拉拉|西雅图|芝加哥|us|america).)*$"
CN = NameRegex, FilterKey = "(?i)(🇨🇳|中国|大陆|国内|回国|cn|china|电信|移动|联通|腾讯|阿里|教育|校园|直连)"

# 💡 策略组分流
# select 模式：手动选择策略组或节点
# ssid 模式：根据设定的网络环境自动切换节点/策略组
# url-test 模式：根据返回结果，选择测速最快的节点
# fallback 模式：根据顺序返回第一个可用的节点
# LoadBalance 负载均衡模式：可选三种算法：random：随机选择策略组可用节点、round-robin：轮询策略组可用节点、pcc：在 random 基础上，针对相同 host 使用同一节点
[Proxy Group]
Pick = select, Auto, Node, Wireless, Fallback, Load Balance, Proxy Chain, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, Chinese, DIRECT, REJECT, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/pick.png
Auto = url-test, ALL, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/auto.png
Node = select, Local, ALL, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/node.png
Wireless = ssid, default = Auto, cellular = Node, "OpenWrt_2.4G" = DIRECT, "OpenWrt_5.8G" = DIRECT, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/wireless.png
Fallback = fallback, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, interval = 600, max-timeout = 3000, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/fallback.png
Load Balance = load-balance, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, interval = 600, algorithm = pcc, max-timeout = 3000, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/load.png
Proxy Chain = select, 🌤️ WARP+, url = http://cp.cloudflare.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/chain.png
HongKong = url-test, HK, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/hongkong.png
Taiwan = url-test, TW, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/taiwan.png
Japan = url-test, JP, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/japan.png
Korea = url-test, KR, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/korea.png
Singapore = url-test, SG, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/singapore.png
America = url-test, US, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/america.png
Nations = url-test, UN, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/nations.png
Chinese = url-test, CN, url = http://www.gstatic.com/generate_204, interval = 600, tolerance = 0, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/chinese.png
Speedtest = select, China, Pick, Node, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/speedtest.png
TikTok = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, China, url =http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/tiktok.png
Telegram = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/telegram.png
Discord = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/discord.png
Spotify = select, Pick, Node, HongKong, Taiwan,Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/spotify.png
Netflix = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/netflix.png
Disney+ = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/disney.png
YouTube = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/youtube.png
OpenAI = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/openai.png
Amazon = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/amazon.png
Facebook = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/facebook.png
Google = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/google.png
Microsoft = select, China, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/microsoft.png
Apple = select, China, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/apple.png
Global Media = select, Global, Pick, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/streaming.png
Global = select, Pick, Node, HongKong, Taiwan, Japan, Korea, Singapore, America, Nations, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/global.png
China Media = select, China, Pick, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/media.png
China = select, DIRECT, Pick, Node, Wireless, Chinese, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/map/china.png
Final = select, Pick, Node, China, AdBlock, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/final.png
AdBlock = select, REJECT, REJECT-DROP, REJECT-NO-DROP, China, Pick, Node, url = http://www.gstatic.com/generate_204, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/adblock.png

# 💡 远程分流规则
[Remote Rule]
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Direct/Direct.list, tag = 🚥 Direct, policy = China, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Lan/Lan.list, tag = 🚥 Lan, policy = China, enabled = true
https://raw.githubusercontent.com/privacy-protection-tools/anti-AD/master/anti-ad-surge.txt, tag = ⛔ AntiAd, policy = AdBlock, enabled = false
https://raw.githubusercontent.com/fmz200/wool_scripts/main/Loon/rule/rejectAd.list, tag = ⛔️ ADReject, policy = AdBlock, enabled = false
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Privacy/Privacy.list, tag = ⛔ Privacy, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Privacy/Privacy_Domain.list, tag = ⛔ Privacy.Domain, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Hijacking/Hijacking.list, tag = ⛔ Hijacking, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/AdvertisingLite/AdvertisingLite.list, tag = ⛔ ADLite, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/AdvertisingLite/AdvertisingLite_Domain.list, tag = ⛔ ADLite.Domain, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/BlockHttpDNS/BlockHttpDNS.list, tag = ⛔ HttpDNS, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Speedtest/Speedtest.list, tag = 🕸️ Speedtest, policy = Speedtest, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/TikTok/TikTok.list, tag = 🎵 TikTok, policy = TikTok, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Telegram/Telegram.list, tag = ✉️ Telegram, policy = Telegram,, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Discord/Discord.list, tag = 🗣️ Discord, policy = Discord,, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Spotify/Spotify.list, tag = 🎶 Spotify, policy = Spotify, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Netflix/Netflix.list, tag = 📽️ Netflix, policy = Netflix, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Disney/Disney.list, tag = 📼 Disney+, policy = Disney+, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/YouTube/YouTube.list, tag = 📹 YouTube, policy = YouTube, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/OpenAI/OpenAI.list, tag = 🤖 OpenAI, policy = OpenAI, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Amazon/Amazon.list, tag = 🛒 Amazon, policy = Amazon, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Facebook/Facebook.list, tag = 🎭 Facebook, policy = Facebook, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Google/Google.list, tag = 📟 Google, policy = Google, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Microsoft/Microsoft.list, tag = 🖥️ Microsoft, policy = Microsoft, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/SystemOTA/SystemOTA.list, tag = 🍎 Apple.ota, policy = AdBlock, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Apple/Apple.list, tag = 🍎 Apple, policy = Apple, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Apple/Apple_Domain.list, tag = 🍎 Apple.Domain, policy = Apple, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/GlobalMedia/GlobalMedia.list, tag = 🎥 Global Media, policy = Global Media, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/GlobalMedia/GlobalMedia_Domain.list, tag = 🎥 Global Media.domain, policy = Global Media, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Global/Global.list, tag = 🌐 Global, policy = Global, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/Global/Global_Domain.list, tag = 🌐 Global.Domain, policy = Global, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/ChinaMedia/ChinaMedia.list, tag = 📺 China Media, policy = China Media, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/China/China.list, tag = 🇨🇳 China, policy = China, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/China/China_Domain.list, tag = 🇨🇳 China.Domain, policy = China, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/ChinaIPs/ChinaIPs.list, tag = 🇨🇳 China.ips, policy = China, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Loon/ChinaIPsBGP/ChinaIPsBGP.list, tag = 🇨🇳 China.bgp, policy = China, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/QuantumultX/ChinaASN/ChinaASN.list, tag = 🇨🇳 China.asn, policy = China, enabled = true

# 💡 本地分流规则
# DOMAIN：基于域名进行判断
# DOMAIN-SUFFIX：基于域名后缀进行判断
# DOMAIN-KEYWORD：基于域名关键词进行判断
# USER-AGENT：根据 http 的 user-agent 值来进行匹配，支持带有 *，？的通配符匹配
# IP-CIDR：ipv4 匹配
# IP-CIDR6：ipv6 匹配
# IP-ASN：匹配 asn 域名与 ip，代替 geoip 方案提供更准确的匹配结果
# DEST-PORT：表示特定的某个端口
# SRC-PORT：表示端口闭区间
# PROTOCOL：根据请求的协议类型规则进行匹配（3.1.7+），目前支持HTTP/HTTPS/TCP/QUIC/STUN/UDP
# AND：逻辑规则，规则内的条件都必须满足
# OR：逻辑规则，规则内的条件只需满足一项即可
# NOT：逻辑规则，必须为规则内不包含的条件
# GEOIP：ip 地理位置匹配
# final：不在规则中的请求，走指定策略
# no-resolve：（可选）跳过域名去进行 dns 解析，当请求为域名匹配到 geoip 或 ip-cidr 规则时，clash 将请求 dns 查询来检查域名的 ip 是否匹配此条规则

[Rule]
# 完整域名匹配
DOMAIN, router.local, China

# 域名后缀匹配
DOMAIN-SUFFIX, home.arpa, China

# 域名关键词匹配
DOMAIN-KEYWORD, localhost, China

# url-regex 匹配
URL-REGEX, ^https?:\/\/(www|m)\.google\.cn, Google

# user-agent 匹配
USER-AGENT, AppleTV*, Global
USER-AGENT, AppleNews*, Global

# 本地 ipv4 匹配规则（no-resolve 只对 ip 类型的生效，域名类型的目标地址不会进行 dns 解析后再去匹配这个规则，为了防止域名类的目标地址做无效的 dns 请求）
IP-CIDR, 10.0.0.0/8, China, no-resolve
IP-CIDR, 100.64.0.0/10, China, no-resolve
IP-CIDR, 127.0.0.0/8, China, no-resolve
IP-CIDR, 172.16.0.0/12, China, no-resolve
IP-CIDR, 192.168.0.0/16, China, no-resolve
IP-CIDR, 224.0.0.0/24, China, no-resolve
IP-CIDR, 169.254.0.0/16, China, no-resolve
IP-CIDR, 183.240.197.130/32, China, no-resolve

# 本地 ipv6 匹配规则 " no-resolve 可选 "
IP-CIDR6, fe80::/10, China, no-resolve

# 根据 ip 服务商进行匹配 " no-resolve 可选 "
IP-ASN, 20940, Global

# 特定的某个端口规则 " 使用 >, <, <=, >= 表示一个无穷区间大/小于或等于，如 DEST-PORT, >=443, AdBlock "
DEST-PORT, 1400, Telegram

# 表示端口区间规则
# SRC-PORT, 80-443, China

# 根据请求的协议类型规则进行匹配（3.1.7+），目前支持HTTP/HTTPS/TCP/QUIC/STUN/UDP
PROTOCOL, STUN, AdBlock

# AND：规则内的条件都必须满足时才会匹配
# AND, ((USER-AGENT, *.youtube*), (PROTOCOL, UDP), (DEST-PORT, 443)), AdBlock
AND, ((DOMAIN-SUFFIX, bilibili.com), (PROTOCOL, QUIC), (DEST-PORT, 4483)), AdBlock
AND, ((DOMAIN-SUFFIX, bilibili.com), (PROTOCOL, QUIC), (DEST-PORT, 9305)), AdBlock
AND, ((PROTOCOL, UDP), (DEST-PORT, 443)), AdBlock
AND, ((PROTOCOL, UDP), (DEST-PORT, 3478)), AdBlock
AND, ((PROTOCOL, UDP), (DEST-PORT, 19302)), AdBlock

# OR：规则内的条件只需满足一项时匹配
# OR, ((DOMAIN, www.axample.com), (DOMAIN-SUFFIX, axample.com), (GEOIP, CN, no-resolve)), China
OR, ((DOMAIN-KEYWORD, httpdns), (DOMAIN-KEYWORD, httpsdns)), AdBlock
OR, ((DOMAIN-KEYWORD, p2ptun), (DOMAIN-KEYWORD, p2plive), (DOMAIN-KEYWORD, p2plog)), AdBlock

# NOT：规则内不包含的条件时匹配
# NOT, ((AND, ((DOMAIN-SUFFIX, axample.com), (DEST-PORT, 443), (GEOIP, CN, no-resolve)))), China
# NOT, ((GEOIP, CN, no-resolve)), Global

# geoip 数据库地区分流规则
GEOIP, CN, China

# 不在规则中的请求，走 final 指定策略
FINAL, Final

# 💡 本地脚本
# cron：根据设定定时触发脚本
# http-response：处理请求的脚本
# http-request：处理请求时响应的脚本
# generic：通用型脚本，以节点、策略组、规则等为参数的脚本，手动触发
# network-changed：网络环境发生变化时触发脚本
# 从 "分" 开始的 5 位 cron 写法，具体表达式可参考：https://crontab.guru
# 比如："*/30 * * * *" 代表每隔 30 分钟自动执行一次
[Script]
cron "30 21 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/ssq/ssq.js, tag = 🎫 Lottery, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/lottery.png, enabled = true
cron "0 12 * * *" script-path = https://raw.githubusercontent.com/aimetu/other/refs/heads/main/Script/maoyan.js, tag = 🎬 MaoYan, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/maoyan.png, enabled = true
cron "0 10 * * *" script-path = https://raw.githubusercontent.com/aimetu/other/refs/heads/main/Script/bing.js, tag = 🖼️ BingWallpaper, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/picture.png, enabled = true
cron "0 10 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/nasa/nasapic.js, tag = 🌕 Nasa, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/nasa.png, enabled = true
cron "0 10 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/idaily/idaily.js, tag = 🌐 iDaily, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/idaily.png, enabled = true
cron "0 9 * * *" script-path = https://raw.githubusercontent.com/aimetu/other/main/Script/oilprice.js, tag = 🛢️ OilPrice, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/oilprice.png, enabled = true
cron "0 9 * * *" script-path = https://raw.githubusercontent.com/Peng-YM/QuanX/master/Tasks/exchange.js, tag = 💰 Exchange, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/exchange.png, enabled = true
cron "0 9 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/appstore/AppMonitor.js, tag = 📱 AppMonitor, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/appstore.png, enabled = true
cron "0 8 * * *" script-path = https://raw.githubusercontent.com/chavyleung/scripts/master/ithome/ithome.js, tag = 🗞️ IThome, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/ithome.png, enabled = false
cron "0 8 * * *" script-path = https://raw.githubusercontent.com/chavyleung/scripts/master/zaker/zaker.js, tag = 📰 ZaKer, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/zaker.png, enabled = false
cron "0 8 * * *" script-path = https://raw.githubusercontent.com/lowking/Scripts/master/bing/bingPoint.js, tag = 🔎 Bing, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/bing.png, enabled = false
cron "0 8 * * *" script-path = https://raw.githubusercontent.com/lowking/Scripts/master/ali/aliYunPanCheckIn.js, tag = ☁️ AliYunPan, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/aliyunpan.png, enabled = false
cron "0 8 * * *" script-path = https://raw.githubusercontent.com/ClydeTime/Quantumult/main/Script/Task/xmlySign.js, tag = 📻 Ximalaya, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/xmly.png, enabled = false
cron "0 8 * * *" script-path = https://raw.githubusercontent.com/ClydeTime/Quantumult/main/Script/Task/BiliBili.js, tag = 🦋 BiliBili, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/bilibili.png, enabled = false
cron "30 7 * * *" script-path = https://raw.githubusercontent.com/githubdulong/Script/master/One.js, tag = 📖 One, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/one.png, enabled = true
cron "30 7 * * *" script-path = https://raw.githubusercontent.com/aimetu/other/main/Script/headlines.js, tag = 📰 HeadLines, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/headlines.png, enabled = true
cron "0 7 * * *" script-path = https://raw.githubusercontent.com/Yuheng0101/X/main/Tasks/moyu.js, tag = 📆 DayMatter, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/daymatter.png, enabled = true
cron "0 7 * * *" script-path = https://raw.githubusercontent.com/aimetu/other/main/Script/histoday.js, tag = 🗓️ HisToday, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/histoday.png, enabled = true
cron "0 7 * * *" script-path = https://raw.githubusercontent.com/TributePaulWalker/Profiles/main/JavaScript/Surge/wnCalendar.js, tag = 📅 Calendar, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/calendar.png, enabled = true
cron "30 7-22/7 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/weibo/weibotalk.js, tag = 👀 WeiBo, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/weibo.png, enabled = false
cron "30 7-22/7 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/wechatsubs/wechatsubs.js, tag = 💬 WeChatSubs, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/wechat.png, enabled = false
cron "30 7-22/7 * * *" script-path = https://raw.githubusercontent.com/evilbutcher/QuantumultX/master/check_in/hotsearch/hot.js, tag = 🔥 HotSearch, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/hotsearch.png, enabled = false
cron "30 6-22/5 * * *" script-path = https://raw.githubusercontent.com/Peng-YM/QuanX/master/Tasks/caiyun.js, tag = 🌤️ CaiYun, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/caiyun.png, enabled = false
generic script-path = https://raw.githubusercontent.com/VirgilClyne/Cloudflare/main/js/1.1.1.1.panel.js, tag = ☁️ Warp, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/warp.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Keywos/rule/master/script/netisp/js/loon.js, tag = 🌐 Netisp, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/network.png, enabled = true
generic script-path = https://kelee.one/Resource/Script/Node_detection_tool/LocationDetection.js, tag = 🗺️ GeoIP, timeout=10, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/geoip.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/nf_check.js, tag = 📽️ Netflix, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/netflixlogo.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/disney_check.js, tag = 📼 Disney+, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/disneylogo.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/ytb_check.js, tag = 📹 YouTube, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/youtubelogo.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/param_check.js, tag = 🎬 Paramount, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/paramount.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/dazn_check.js, tag = 🎬 Dazn, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/dazn.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/discovery_check.js, tag = 🎬 Discovery, img-url = https://raw.githubusercontent.com/aimetu/icons/main/logo/discovery.png, enabled = true
generic script-path = https://raw.githubusercontent.com/Loon0x00/LoonScript/main/MediaCheck/check.js, tag = 🎥 Streaming, img-url = https://raw.githubusercontent.com/aimetu/icons/main/other/streaming.png, enabled = true

# 💡 远程脚本
[Remote Script]
https://raw.githubusercontent.com/Tartarus2014/Loon-Script/master/Fake_Vip.conf, tag = 🔐 Vip, enabled = false
https://raw.githubusercontent.com/Tartarus2014/Loon-Script/master/Cookie.conf, tag = 🏷️ Cookie, enabled = false
https://raw.githubusercontent.com/fmz200/wool_scripts/main/Loon/script/tasks.scripts, tag = ⏰ Task, enabled = false
https://raw.githubusercontent.com/Tartarus2014/Loon-Script/master/Script.conf, tag = 🗒️ Script, enabled = false
https://raw.githubusercontent.com/deezertidal/private/main/Script_Ultra.js, tag = 📄 Script.ultra, enabled = false

# 💡 本地复写
# 302：返回 302 响应，以达到重定向的目的
# 307：返回 307 响应，以达到重定向的目的
# reject：直接断开连接，返回一个 404 响应
# reject-200：返回一个 200 响应体，内容为空
# reject-img：返回一个 200 响应体为，内容为 1 像素的图片
# reject-dict：返回一个 200 响应体，内容为 {} 的空 json 对象
# reject-array：返回一个 200 响应体，内容为 [] 的空 json 对象
# reject-video：返回一个 200 响应体，内容为空白的视频
# header：修改请求头，客户端不会感知重定向
# header-add：在 header 中添加一组字段
# header-del：在 header 中删除一组字段
# header-replace：替换 header 中的指定字段
# header-replace-regex：替换 header 中的正则匹配字段
[Rewrite]
^https?:\/\/(www|m)\.(g|google)\.cn https://www.google.com 302
^https?:\/\/(ditu|maps)\.google\.cn https://maps.google.com 302
# 启用 baidu 或 google 复写，需将域名 *.baidu.com, *.google.com, *.google.com.hk 添加到 mitm 解析
#^https?:\/\/(www|cn)\.bing\.com\/(s|search).+(q=[^&]+) header-replace User-Agent Mozilla/5.0 (iPhone; CPU iPhone OS 16_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Version/16.3 Mobile/15E148 Safari/605.1.15 BingSapphire/1.0.420524001
#^https?:\/\/(www|m)\.baidu\.com\/(s|search).+(wd|word=[^&]+) header-replace User-Agent Mozilla/5.0 (iPhone; CPU iPhone OS 16_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 TraditionalTpl/1.0 ChatSearch/1.0 SearchCraft/5.8.2.10 (Baidu; P2 16.3)
#^https?:\/\/(www|m)\.baidu\.com\/(from=[^&]+)\/(s|search).+(wd|word=[^&]+) header-replace User-Agent Mozilla/5.0 (iPhone; CPU iPhone OS 16_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 ChatSearch/1.0 SearchCraft/5.8.2.10 (Baidu; P2 16.3)
#^https?:\/\/(?!d\.pcs).*(?<!map)\.baidu\.com\/(s|search).+(wd|word=[^&]+) header-replace User-Agent Mozilla/5.0 (iPhone; CPU iPhone OS 16_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) Mobile/15E148 SP-engine/2.91.0 main%2F1.0 baiduboxapp/13.53.5.10 (Baidu; P2 16.3) NABar/1.0 themeUA=Theme/default
#^https:\/\/(www|m)\.google\.com\/(m|search|gasearch).+(q=[^&]+) header-replace User-Agent Mozilla/5.0 (iPhone; CPU iPhone OS 16_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) GSA/308.0.615969171 Mobile/15E148 Safari/604.1
#^https:\/\/(www|m)\.google\.com\.hk\/(m|search|gasearch).+(q=[^&]+) header-replace User-Agent Mozilla/5.0 (iPhone; CPU iPhone OS 16_3 like Mac OS X) AppleWebKit/605.1.15 (KHTML, like Gecko) GSA/308.0.615969171 Mobile/15E148 Safari/604.1

# 💡 插件仓库
[Plugin]
https://raw.githubusercontent.com/Peng-YM/Loon-Gallery/master/loon-gallery.plugin, tag = 🎈 Plugin, enabled = false
https://raw.githubusercontent.com/aimetu/other/main/Loon/unlock.plugin, tag = 🔐 Unlock, enabled = false
https://raw.githubusercontent.com/fmz200/wool_scripts/main/Loon/plugin/blockAds.plugin, tag = ⛔️ Fmz200, enabled= false
https://raw.githubusercontent.com/fmz200/wool_scripts/main/Loon/plugin/cookies.plugin, tag = 🍪 Cookie, enabled = false
https://github.com/BiliUniverse/ADBlock/releases/latest/download/BiliBili.ADBlock.plugin, tag = 🎬 BiliBili, enabled = false
https://kelee.one/Tool/Loon/Plugin/YouTube_remove_ads.plugin, tag = 📹 YouTube, enabled = true
https://raw.githubusercontent.com/Semporia/tiktok-Unlock/master/Loon/TikTok.plugin, tag = 🎵 TikTok, policy = TikTok, enabled = false
https://github.com/DualSubs/YouTube/releases/latest/download/DualSubs.YouTube.plugin, tag = 🍿️ YouTube, enabled = true
https://github.com/DualSubs/Universal/releases/latest/download/DualSubs.Universal.plugin, tag = 🍿️ Streaming, enabled = false
https://raw.githubusercontent.com/VirgilClyne/Cloudflare/main/modules/Cloudflare.1.1.1.1.plugin, tag = ☁️ Cloudflare Warp, enabled = false
https://raw.githubusercontent.com/app2smile/rules/master/plugin/adsense.plugin, tag = ⛔ AdSense, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/BlockHTTPDNS/BlockHTTPDNS.plugin, tag = ⛔ HttpDNS, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/SafeRedirect/SafeRedirect.plugin, tag = 🔒 SafeRedirect, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/Redirect/Redirect.plugin, tag = ✍️ Redirect, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/Upgrade/Upgrade.plugin, tag = ⛔ Upgrade, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/AdvertisingScript/AdvertisingScript.plugin, tag = ⛔ AdScript, enabled = true
https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rewrite/Loon/AdvertisingLite/AdvertisingLite.plugin, tag = ⛔ AdLite, enabled = true
https://raw.githubusercontent.com/chavyleung/scripts/master/box/rewrite/boxjs.rewrite.loon.plugin, tag = 🗃️ BoxJs, policy = China, enabled = true
https://raw.githubusercontent.com/Peng-YM/Sub-Store/master/config/Loon.plugin, tag = 📍 Sub-Store, policy = China, enabled = false

# 💡 解密 https 请求，需安装证书并信任
[MITM]
# 跳过服务器证书验证
skip-server-cert-verify = true

# 需解密的域名，可以使用通配符 * 或 ？ 来表示域名，以 - 开头来排除域名
hostname = *.g.cn, *.google.cn

# 生成的证书参数
# ca-p12 = 
# ca-passphrase = 
